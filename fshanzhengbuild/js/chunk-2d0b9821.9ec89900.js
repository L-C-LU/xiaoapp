(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b9821"],{"32f2":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"i-layout-page-header"},[a("PageHeader",{attrs:{title:"行政区域设置",content:"","hidden-breadcrumb":""}})],1),a("Card",{staticClass:"ivu-mt",attrs:{bordered:!1,"dis-hover":""}},[a("div",[a("Form",{ref:"form",attrs:{model:t.formData,rules:t.rules,"label-width":t.labelWidth,"label-position":t.labelPosition}},[a("Row",{attrs:{gutter:24,type:"flex",justify:"end"}},[a("Col",{attrs:{span:"14"}},[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",icon:"md-add"},on:{click:t.handleShowCreate}},[t._v("新建")]),a("Button",{class:{active:3==t.formData.region_type},staticStyle:{"margin-right":"5px"},on:{click:function(e){return t.toSelectType(3)}}},[t._v("省份")]),a("Button",{class:{active:4==t.formData.region_type},staticStyle:{"margin-right":"5px"},attrs:{label:"default"},on:{click:function(e){return t.toSelectType(4)}}},[t._v("城市")]),a("Button",{class:{active:5==t.formData.region_type},staticStyle:{"margin-right":"10px"},attrs:{label:"small"},on:{click:function(e){return t.toSelectType(5)}}},[t._v("区县")]),a("Button",{attrs:{disabled:t.disableGotoParentBtn()},on:{click:t.gotoParent}},[t._v("返回上级")])],1),a("Col",t._b({staticClass:"ivu-text-right"},"Col",t.grid,!1),[a("FormItem",{attrs:{label:"",prop:"keyword","label-for":"keyword"}},[a("Input",{staticStyle:{width:"60%","margin-right":"10px"},attrs:{placeholder:"角色名称","element-id":"keyword"},model:{value:t.formData.keyword,callback:function(e){t.$set(t.formData,"keyword",e)},expression:"formData.keyword"}}),a("Button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("查询")]),a("Button",{staticClass:"ivu-ml-8",on:{click:t.handleReset}},[t._v("重置")])],1)],1)],1)],1),a("div",{staticClass:"i-table-no-border"},[a("Table",{ref:"table",attrs:{columns:t.columns,data:t.data.list,loading:t.loading,border:"","show-header":""},on:{"on-sort-change":t.handleSortChange},scopedSlots:t._u([{key:"region_type",fn:function(e){var a=e.row;return[t._v("\n               "+t._s(t.regionTypeItems[a.region_type])+"\n            ")]}},{key:"parent_id",fn:function(e){var n=e.row;return[parseInt(n.region_type)-1<3?a("span",[t._v("--")]):a("a",{on:{click:function(e){t.linkToParent(parseInt(n.region_type)-1,n.parent_id)}}},[t._v(t._s(t.regionTypeItems[parseInt(n.region_type)-1]+"："+n.parent_name_chs))])]}},{key:"sun_id",fn:function(e){var n=e.row;return[parseInt(n.region_type)+1>5?a("span",[t._v("--")]):a("a",{on:{click:function(e){t.linkToSun(parseInt(n.region_type)+1,n.id)}}},[t._v(t._s("下属"+t.regionTypeItems[parseInt(n.region_type)+1]))])]}},{key:"action",fn:function(e){e.row;var n=e.index;return[a("a",{on:{click:function(e){return t.handleShowUpdate(n)}}},[t._v("编辑")]),a("Divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(e){return t.handleDelete(n)}}},[t._v("删除")])]}}])}),a("div",{staticClass:"ivu-mt ivu-text-center"},[a("Page",{attrs:{total:t.data.total,current:t.data.page,"show-total":"","show-sizer":"","page-size-opts":[10,20,50,100],"show-elevator":!0},on:{"update:current":function(e){return t.$set(t.data,"page",e)},"on-change":t.handleToPage,"on-page-size-change":t.handlePageSize}})],1),a("Modal",{attrs:{title:"添加行政区域",loading:t.create.loading,width:600},on:{"on-ok":t.handleCreate},model:{value:t.create.show,callback:function(e){t.$set(t.create,"show",e)},expression:"create.show"}},[a("Form",{ref:"create",attrs:{model:t.create.data,rules:t.create.rules,"label-width":120}},[a("FormItem",{attrs:{label:"行政区域类型：",prop:"region_type"}},[a("Select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择行政区域类型"},model:{value:t.create.data.region_type,callback:function(e){t.$set(t.create.data,"region_type",e)},expression:"create.data.region_type"}},[a("Option",{attrs:{value:3}},[t._v("省份")]),a("Option",{attrs:{value:4}},[t._v("城市")])],1)],1),a("FormItem",{attrs:{label:"拼音首字母","label-position":"top",prop:"initial"}},[a("Input",{staticStyle:{width:"90%"},attrs:{placeholder:"请输入拼音首字母",maxlength:1,minlength:1},on:{"on-change":function(e){t.create.data.initial=t.create.data.initial.toUpperCase()}},model:{value:t.create.data.initial,callback:function(e){t.$set(t.create.data,"initial",e)},expression:"create.data.initial"}})],1),t.create.data.region_type>=4?a("FormItem",{attrs:{label:"省份","label-position":"top",prop:"province_id"}},[a("Select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择所在省份"},model:{value:t.create.data.province_id,callback:function(e){t.$set(t.create.data,"province_id",e)},expression:"create.data.province_id"}},t._l(t.dict.province,function(e,n){return a("Option",{key:n,attrs:{value:n}},[t._v(t._s(e))])}),1)],1):t._e(),a("FormItem",{attrs:{label:"中文名称","label-position":"top",prop:"name_chs"}},[a("Input",{staticStyle:{width:"90%"},attrs:{placeholder:"最多可输入50字符"},model:{value:t.formData.name_chs,callback:function(e){t.$set(t.formData,"name_chs",e)},expression:"formData.name_chs"}})],1),a("FormItem",{attrs:{label:"英文名称","label-position":"top",prop:"name_en"}},[a("Input",{staticStyle:{width:"90%"},attrs:{placeholder:"最多可输入80字符"},model:{value:t.formData.name_en,callback:function(e){t.$set(t.formData,"name_en",e)},expression:"formData.name_en"}})],1)],1)],1),a("Modal",{attrs:{title:"编辑角色",loading:t.update.loading},on:{"on-ok":t.handleUpdate},model:{value:t.update.show,callback:function(e){t.$set(t.update,"show",e)},expression:"update.show"}},[a("Form",{ref:"update",attrs:{model:t.update.data,rules:t.update.rules,"label-width":100}},[a("FormItem",{attrs:{label:"角色名称：",prop:"name"}},[a("Input",{staticStyle:{width:"90%"},attrs:{placeholder:"请输入角色名称"},model:{value:t.update.data.name,callback:function(e){t.$set(t.update.data,"name","string"===typeof e?e.trim():e)},expression:"update.data.name"}})],1),a("FormItem",{attrs:{label:"唯一编号：",prop:"role_key"}},[a("Input",{staticStyle:{width:"90%"},attrs:{placeholder:"请输入唯一编号"},model:{value:t.update.data.role_key,callback:function(e){t.$set(t.update.data,"role_key","string"===typeof e?e.trim():e)},expression:"update.data.role_key"}})],1),a("FormItem",{attrs:{label:"备注：",prop:"remark"}},[a("Input",{staticStyle:{width:"90%"},attrs:{placeholder:"请输入备注"},model:{value:t.update.data.remark,callback:function(e){t.$set(t.update.data,"remark","string"===typeof e?e.trim():e)},expression:"update.data.remark"}})],1)],1)],1)],1)],1)])],1)},r=[],i=a("a34a"),o=a.n(i),s=a("b6bd");function l(t){return Object(s["a"])({url:"/Manage/Region/list",method:"post",data:t})}function c(t){return Object(s["a"])({url:"/Manage/Region/add",method:"post",data:t})}function d(t){return Object(s["a"])({url:"/Manage/Region/delete",method:"post",data:t})}function u(t){return Object(s["a"])({url:"/Manage/Region/update",method:"post",data:t})}var p=a("2f62");function h(t,e,a,n,r,i,o){try{var s=t[i](o),l=s.value}catch(c){return void a(c)}s.done?e(l):Promise.resolve(l).then(n,r)}function m(t){return function(){var e=this,a=arguments;return new Promise(function(n,r){var i=t.apply(e,a);function o(t){h(i,n,r,o,s,"next",t)}function s(t){h(i,n,r,o,s,"throw",t)}o(void 0)})}}function g(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?g(a,!0).forEach(function(e){_(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):g(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var y={name:"system-region-list",data:function(){var t=this;return{selectedButton:0,regionTypeItems:["全球","大洲","国家地区","省份","城市","区县"],formData:{keyword:"",id:"",parent_id:"",region_type:""},rules:{},grid:{xl:10,lg:10,md:10,sm:24,xs:24},columns:[{title:"序号",width:65,render:function(e,a){return e("div",a.index+1+parseInt(t.data.page_size)*(parseInt(t.data.page)-1))}},{title:"类型",key:"region_type",slot:"region_type",width:100,sortable:"custom"},{title:"中文名",key:"name_chs",minWidth:100},{title:"英文名",key:"name_en",minWidth:160},{title:"上级区域",key:"parent_id",width:220,slot:"parent_id"},{title:"下属区域",width:220,slot:"sun_id"},{title:"添加时间",key:"create_time",width:180,sortable:"custom"},{title:"操作",slot:"action",align:"center",width:160}],loading:!1,dict:{},data:{list:[],page:1,page_size:10,page_count:0,total:0},sort_column:"id",sort_direction:"asc",create:{loading:!0,show:!1,data:{region_type:"",province_id:"",name_chs:"",name_en:"",initial:""},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],role_key:[{required:!0,message:"请输入唯一编号",trigger:"blur"}],remark:[{required:!1,message:"请输入备注",trigger:"blur"}]}},update:{loading:!0,show:!1,data:{name:"",role_key:"",remark:""},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],role_key:[{required:!0,message:"请输入唯一编号",trigger:"blur"}],remark:[{required:!1,message:"请输入备注",trigger:"blur"}]}}}},computed:f({},Object(p["e"])("admin/layout",["isMobile"]),{labelWidth:function(){return this.isMobile?void 0:100},labelPosition:function(){return this.isMobile?"top":"right"}}),methods:{getList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading=!0;var a={page_size:this.data.page_size,page:this.data.page,sort_column:this.sort_column,sort_direction:this.sort_direction};return console.log(a),a=Object.assign(this.formData,a),a.dict=e?"province":"",new Promise(function(n,r){l(a).then(function(){var a=m(o.a.mark(function a(r){return o.a.wrap(function(a){while(1)switch(a.prev=a.next){case 0:e&&(t.dict=r.dict),t.data.list=r.list,t.data.total=r.total,t.data.page=r.page,t.data.page_size=r.page_size,t.data.page_count=r.page_count,t.loading=!1,n();case 8:case"end":return a.stop()}},a)}));return function(t){return a.apply(this,arguments)}}()).catch(function(t){r(t)})})},handleSubmit:function(){this.getList()},disableGotoParentBtn:function(){var t=this.formData.region_type?this.formData.region_type:0;return t<=0},gotoParent:function(){var t=this.formData.region_type?this.formData.region_type:0;t=parseInt(t)-1,t<3&&(t=3);var e=this.formData.parent_id?this.formData.parent_id:0;this.linkToParent(t,e)},linkToParent:function(t,e){this.formData.region_type=t,this.formData.id=e,this.formData.parent_id="",this.handleToPage(1)},linkToSun:function(t,e){this.formData.region_type=t,this.formData.parent_id=e,this.formData.id="",this.handleToPage(1)},toSelectType:function(t){this.formData.id="",this.formData.parent_id="",this.selectedButton=t,this.formData.region_type=t,this.handleToPage(1)},handleToPage:function(t){this.data.page=t,this.getList()},handlePageSize:function(t){this.data.page_size=t,this.data.page=1,this.getList()},handleShowUpdate:function(t){this.update.show=!0,this.update.data.id=this.data.list[t].id,this.update.data.name=this.data.list[t].name,this.update.data.remark=this.data.list[t].remark,this.update.data.role_key=this.data.list[t].role_key},handleUpdate:function(){var t=this;this.$refs.update.validate(function(e){if(e)return new Promise(function(e,a){u(t.update.data).then(function(){var a=m(o.a.mark(function a(n){return o.a.wrap(function(a){while(1)switch(a.prev=a.next){case 0:t.$Message.success("操作成功"),t.update.show=!1,t.update.loading=!1,t.$refs.update.resetFields(),t.$nextTick(function(){t.update.loading=!0}),t.getList(),e();case 7:case"end":return a.stop()}},a)}));return function(t){return a.apply(this,arguments)}}()).catch(function(e){t.update.loading=!1,t.$nextTick(function(){t.update.loading=!0}),a(e)})});t.update.loading=!1,t.$nextTick(function(){t.update.loading=!0})})},handleReset:function(){this.$refs.form.resetFields()},handleDelete:function(t){var e=this;this.$Modal.confirm({title:"删除角色",content:"确定删除该角色吗？[ 名称: "+this.data.list[t].name+" ]",onOk:function(){return new Promise(function(a,n){d({id:e.data.list[t].id}).then(function(){var t=m(o.a.mark(function t(n){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.getList(),e.$Message.success("操作成功"),a();case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(t){n(t)})})}})},handleSortChange:function(t){var e=t.key,a=t.order;this.sort_column=e,this.sort_direction=a,this.data.page=1,this.getList()},handleShowCreate:function(){this.create.show=!0},handleCreate:function(){var t=this;this.$refs.create.validate(function(e){if(e)return new Promise(function(e,a){c(t.create.data).then(function(){var a=m(o.a.mark(function a(n){return o.a.wrap(function(a){while(1)switch(a.prev=a.next){case 0:t.$Message.success("操作成功"),t.create.show=!1,t.create.loading=!1,t.$refs.create.resetFields(),t.$nextTick(function(){t.create.loading=!0}),t.getList(),e();case 7:case"end":return a.stop()}},a)}));return function(t){return a.apply(this,arguments)}}()).catch(function(e){t.create.loading=!1,t.$nextTick(function(){t.create.loading=!0}),a(e)})});t.create.loading=!1,t.$nextTick(function(){t.create.loading=!0})})}},watch:{$route:function(t,e){this.$router.go(0)}},mounted:function(){this.formData.region_type=3,this.getList(!0)}},v=y,b=a("2877"),w=Object(b["a"])(v,n,r,!1,null,null,null);e["default"]=w.exports}}]);
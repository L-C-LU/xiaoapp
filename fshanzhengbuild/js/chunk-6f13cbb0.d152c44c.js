(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f13cbb0"],{"45fe":function(t,e,i){"use strict";var a=i("79da"),n=i.n(a);n.a},"6d4b":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"upload-wrap"},[i("Modal",{attrs:{title:"文件管理","close-on-click-modal":!1,"custom-class":"upload-dialog","close-on-press-escape":!1,width:t.dialogWidth,"append-to-body":!0},on:{"on-cancel":t.cancelFunc},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[i("Row",{staticClass:"ivu-mb-16"},[i("Col",{attrs:{span:"16"}},[i("Button",{attrs:{size:"default",icon:"md-add"},on:{click:t.addCategory}},[t._v("添加分类")]),i("Poptip",{attrs:{placement:"bottom"}},[i("Button",{staticClass:"ivu-ml-8",attrs:{size:"default",icon:"md-move"}},[t._v("移动至")]),i("div",{staticClass:"api",attrs:{slot:"content"},slot:"content"},[i("ul",{staticClass:"move-type"},t._l(t.typeList,function(e,a){return i("li",{key:a,on:{click:function(i){return t.moveTypeFunc(e.group_id)}}},[t._v("\n               "+t._s(e.group_name)+"\n             ")])}),0)])],1),i("Button",{staticClass:"ivu-ml-8",attrs:{size:"default",type:"danger",icon:"md-close"},on:{click:function(e){return t.deleteFileFunc(!1)}}},[t._v("批量删除")])],1),i("Col",{staticClass:"ivu-text-right",attrs:{span:"8"}},[i("Upload",{ref:"upload",attrs:{multiple:"",headers:t.upload.headers,"show-upload-list":!1,data:t.upload.params,"max-size":1e5,"on-success":t.handleUploadSuccess,"on-error":t.handleUploadError,action:t.uploadAction,"before-upload":t.onBeforeUploadImage}},[i("Button",{attrs:{size:"default",icon:"md-cloud-upload",type:"primary",loading:t.upload.loading}},[t._v("点击上传")])],1)],1)],1),i("div",{staticClass:"fileContainer"},[i("div",{staticClass:"file-type"},[i("ul",t._l(t.typeList,function(e,a){return i("li",{key:a,class:t.selectedGroupId==e.group_id?"item active":"item",on:{click:function(i){return t.selectTypeFunc(e.group_id)}}},[t._v("\n            "+t._s(e.group_name)+"\n            "),null!=e.group_id?i("div",{staticClass:"operation",on:{click:function(t){t.stopPropagation()}}},[i("p",{on:{click:function(i){return t.editCategoryFunc(e)}}},[i("Icon",{attrs:{type:"md-card"}})],1),i("p",{on:{click:function(i){return t.deleteCategoryFunc(e.group_id)}}},[i("Icon",{attrs:{type:"md-trash"}})],1)]):t._e()])}),0)]),i("div",{staticClass:"file-content"},[i("ul",{staticClass:"fileContainerUI clearfix"},t._l(t.fileList.list,function(e,a){return i("li",{key:a,staticClass:"file",on:{click:function(i){return t.selectFileFunc(e,a)}}},[1==e.selected?i("div",{staticClass:"selectedIcon"},[i("Icon",{attrs:{type:"md-checkmark"}})],1):t._e(),i("img",{style:"background-image:url("+e.file_path+")",attrs:{scr:e.file_path,alt:""}}),i("p",{staticClass:"desc"},[t._v(t._s(e.real_name))]),i("div",{staticClass:"bottom-shade",on:{click:function(t){t.stopPropagation()}}},[i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(i){return t.deleteFileFunc(e)}}},[i("Icon",{staticStyle:{"font-size":"18px"},attrs:{type:"ios-trash-outline"}})],1)])])}),0)])]),i("div",{staticClass:"pagination-wrap"},[i("el-pagination",{attrs:{"current-page":t.curPage,"page-sizes":[12,24,36,42,48],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalDataNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{size:"default"},on:{click:t.cancelFunc}},[t._v("取 消")]),i("Button",{attrs:{size:"default",type:"primary"},on:{click:t.confirmFunc}},[t._v("确 定")])],1)],1),i("AddCategory",{attrs:{showSecondModal:t.isShowCategory,isEditMode:t.isEditMode,category:t.category},on:{"update:showSecondModal":function(e){t.isShowCategory=e},"update:show-second-modal":function(e){t.isShowCategory=e},closeCategory:t.closeCategoryFunc}})],1)},n=[],o=i("a34a"),s=i.n(o),r=i("c276"),c=i("d708"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Modal",{attrs:{title:"添加分类",width:"30%"},on:{"on-cancel":t.handleClose,"on-visible-change":t.onVisableChange,"on-ok":function(e){return t.submitForm("form")}},model:{value:t.showSecondModal,callback:function(e){t.showSecondModal=e},expression:"showSecondModal"}},[i("Form",{ref:"form",staticClass:"demo-ruleForm",attrs:{size:"small",model:t.formData,"label-width":"100px"}},[i("FormItem",{attrs:{label:"分类名称",prop:"group_name",rules:[{required:!0,message:"名字不能为空",trigger:"blur"}]}},[i("Input",{model:{value:t.formData.group_name,callback:function(e){t.$set(t.formData,"group_name",t._n(e))},expression:"formData.group_name"}})],1)],1)],1)},u=[];function d(t,e,i,a,n,o,s){try{var r=t[o](s),c=r.value}catch(l){return void i(l)}r.done?e(c):Promise.resolve(c).then(a,n)}function h(t){return function(){var e=this,i=arguments;return new Promise(function(a,n){var o=t.apply(e,i);function s(t){d(o,a,n,s,r,"next",t)}function r(t){d(o,a,n,s,r,"throw",t)}s(void 0)})}}var p={data:function(){return{formData:{group_name:""}}},props:{isEditMode:!1,category:{},showSecondModal:{type:Boolean,default:!1}},created:function(){null!=this.category&&(this.formData.group_name=this.category.group_name,this.formData.group_id=this.category.group_id)},watch:{isEditMode:function(){},category:function(){null==this.category?(this.formData.group_name="",this.formData.group_id=""):(this.formData.group_name=this.category.group_name,this.formData.group_id=this.category.group_id)}},methods:{cancelFunc:function(){this.showSecondModal=!1},addCategory:function(){var t=this,e={group_name:this.formData.group_name};this.$http.query("/Manage/File/addCategory",e).then(function(){var e=h(s.a.mark(function e(i){return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.$Message.success("添加成功"),t.handleClose({status:"success"});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(t){console.log(t)})},editCategory:function(){var t=this,e=this,i=this.formData;this.$http.query("/Manage/File/updateCategory",i).then(function(){var i=h(s.a.mark(function i(a){return s.a.wrap(function(i){while(1)switch(i.prev=i.next){case 0:t.$Message.success("编辑成功"),e.handleClose({status:"success"});case 2:case"end":return i.stop()}},i)}));return function(t){return i.apply(this,arguments)}}()).catch(function(t){console.log(t)})},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;console.log("editMode"),console.log(e.isEditMode),e.category&&e.isEditMode?e.editCategory():e.isEditMode?e.$Message.success("未指定操作"):e.addCategory()})},handleClose:function(t){this.$emit("closeCategory",t)},onVisableChange:function(t){t&&(this.isEditMode||(this.formData.group_name="")),this.$emit("update:showSecondModal",t)}}},g=p,f=i("2877"),m=Object(f["a"])(g,l,u,!1,null,null,null),y=m.exports;function v(t,e,i,a,n,o,s){try{var r=t[o](s),c=r.value}catch(l){return void i(l)}r.done?e(c):Promise.resolve(c).then(a,n)}function C(t){return function(){var e=this,i=arguments;return new Promise(function(a,n){var o=t.apply(e,i);function s(t){v(o,a,n,s,r,"next",t)}function r(t){v(o,a,n,s,r,"throw",t)}s(void 0)})}}var _={components:{AddCategory:y},data:function(){return{isEditMode:!1,showAddCategory:!1,dialogWidth:"910px",selectedGroupId:null,typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1},upload:{headers:{"x-auth-token":r["a"].cookies.get("token")},action:c["a"].apiBaseURL+"Publics/Upload/image",loading:!1,show:!1,process:!0,file:"",params:{},data:{}},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1,category:{group_id:null,group_name:""},fileIds:[]}},props:["config"],created:function(){if("[object object]"===Object.prototype.toString.call(this.config).toLowerCase())for(var t in this.config)this.this_config[t]=this.config[t];this.getFileCategory(),this.getData()},mounted:function(){this.uploadAction=c["a"].apiBaseURL+"Publics/Upload/image"},methods:{getFileCategory:function(){var t=this,e={};this.$http.query("/Manage/File/category",e).then(function(){var e=C(s.a.mark(function e(i){var a;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=[{group_id:null,group_name:"全部"},{group_id:0,group_name:"未分组"}],t.typeList=a.concat(i.list),console.log(t.typeList);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(){t.loading=!1})},addCategory:function(){this.isEditMode=!1,this.isShowCategory=!1,this.isShowCategory=!0},editCategoryFunc:function(t){this.isEditMode=!0,this.isShowCategory=!0,this.category=t},closeCategoryFunc:function(t){null!=t&&this.getFileCategory(),this.isShowCategory=!1},deleteCategoryFunc:function(t){var e=this;this.$Modal.confirm({title:"删除提示",content:"将永久删除该记录, 是否继续？",onOk:function(){e.deleteCategory(t)}})},deleteCategory:function(t){var e=this,i={group_id:t};this.$http.query("/Manage/File/deleteCategory",i).then(function(){var t=C(s.a.mark(function t(i){return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.$Message.success("删除成功"),e.getFileCategory();case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.loading=!1,e.$Message.success("删除失败")})},selectTypeFunc:function(t){this.selectedGroupId=t,this.curPage=1,this.getData()},handleCurrentChange:function(t){this.curPage=t,this.getData()},handleSizeChange:function(t){this.curPage=1,this.pageSize=t,this.getData()},getData:function(){var t=this,e={page:this.curPage,page_size:this.pageSize,group_id:this.selectedGroupId};this.$http.query("/Manage/File/fileList",e).then(function(){var e=C(s.a.mark(function e(i){return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.loading=!1,t.fileList=i,t.totalDataNumber=i.total;case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(){t.loading=!1})},moveTypeFunc:function(t){var e=this,i=[];this.fileList.list.forEach(function(t){t.selected&&i.push(t.file_id)}),0!==i.length?this.$Modal.confirm({title:"移动提示",content:"确定移动选中的文件吗？, 是否继续？",onOk:function(){e.moveType(t,i)}}):this.$Message.warning("请选择文件")},moveType:function(t,e){var i=this,a={group_id:t,file_ids:e.join(",")};this.$http.query("/Manage/File/moveFiles",a).then(function(){var t=C(s.a.mark(function t(e){return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:i.$Message.success("操作成功"),i.getFileCategory(),i.getData();case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){i.loading=!1})},fileChange:function(t){console.log(t)},onBeforeUploadImage:function(t){this.upload.loading=!0;var e="image/jpeg"===t.type||"image/jpg",i=t.size/1024/1024<100;return e?i?(this.upload.file=t,this.uploadImage(),!1):(this.upload.loading=!1,this.$Message.error("上传文件大小不能超过 100MB!"),!1):(this.upload.loading=!1,this.$Message.error("上传文件只能是图片格式!"),!1)},handleUploadSuccess:function(t,e){this.upload.loading=!1,this.getData()},uploadImage:function(){this.upload.params.group_id=this.selectedGroupId,this.$refs.upload.post(this.upload.file),this.upload.loading=!1},selectFileFunc:function(t,e){t.selected?(t.selected=!1,this.record--):(t.selected=!0,this.record++),this.$set(this.fileList.list,e,t)},handleUploadError:function(t,e){this.$Message.error(e.message)},deleteFileFunc:function(t){var e=this;this.$Modal.confirm({title:"删除提示",content:"此操作将永久删除该文件, 是否继续？",onOk:function(){e.deleteFile(t)}})},deleteFile:function(t){var e=this,i=[];if(t)i.push(t.file_id);else for(var a=0;a<this.fileList.list.length;a++){var n=this.fileList.list[a];n.selected&&i.push(n.file_id)}var o={file_ids:i.join(",")};this.$http.query("/Manage/File/deleteFiles",o).then(function(){var t=C(s.a.mark(function t(i){return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.loading=!1,e.getData();case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.loading=!1})},confirmFunc:function(){for(var t=[],e=0,i=0;i<this.fileList.list.length;i++){var a=this.fileList.list[i];if(a.selected){var n={file_id:a.file_id,file_path:a.file_path};t.push(n),e++}if(e>this.this_config.total)break}this.$emit("returnImgs",t)},cancelFunc:function(){this.$emit("returnImgs",null)}}},w=_,b=(i("45fe"),Object(f["a"])(w,a,n,!1,null,"9740c0fa",null));e["a"]=b.exports},"79da":function(t,e,i){},b713:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("script",{attrs:{id:"editor",type:"text/plain"}}),t.isupload?i("Upload",{attrs:{config:{total:9},isupload:t.isupload},on:{returnImgs:t.returnImgsFunc}},[t._v("上传图片")]):t._e()],1)},n=[],o=i("6d4b"),s={components:{Upload:o["a"]},name:"ue",data:function(){return{editor:null,isupload:!1,hasCallback:!1,callback:null,this_config:{autoFloatEnabled:!1}}},props:{text:String,config:Object},created:function(){window.openUpload=this.openUpload},watch:{},mounted:function(){var t=this;Object.assign(this.this_config,this.config),this.editor=window.UE.getEditor("editor",this.this_config),this.editor.addListener("ready",function(e){t.editor.setContent(t.text)}),this.editor.addListener("contentChange",function(e){t.$emit("contentChange",t.editor.getContent())})},methods:{getUEContent:function(){return this.editor.getContent()},openUpload:function(t){this.isupload=!0,t&&(this.hasCallback=!0,this.callback=t)},returnImgsFunc:function(t){null!=t&&this.hasCallback&&this.callback(t),this.isupload=!1}},destroyed:function(){this.editor.destroy()}},r=s,c=i("2877"),l=Object(c["a"])(r,a,n,!1,null,null,null);e["a"]=l.exports}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50ee374c"],{"45fe":function(t,e,a){"use strict";var i=a("79da"),o=a.n(i);o.a},"6d4b":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"upload-wrap"},[a("Modal",{attrs:{title:"文件管理","close-on-click-modal":!1,"custom-class":"upload-dialog","close-on-press-escape":!1,width:t.dialogWidth,"append-to-body":!0},on:{"on-cancel":t.cancelFunc},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[a("Row",{staticClass:"ivu-mb-16"},[a("Col",{attrs:{span:"16"}},[a("Button",{attrs:{size:"default",icon:"md-add"},on:{click:t.addCategory}},[t._v("添加分类")]),a("Poptip",{attrs:{placement:"bottom"}},[a("Button",{staticClass:"ivu-ml-8",attrs:{size:"default",icon:"md-move"}},[t._v("移动至")]),a("div",{staticClass:"api",attrs:{slot:"content"},slot:"content"},[a("ul",{staticClass:"move-type"},t._l(t.typeList,function(e,i){return a("li",{key:i,on:{click:function(a){return t.moveTypeFunc(e.group_id)}}},[t._v("\n               "+t._s(e.group_name)+"\n             ")])}),0)])],1),a("Button",{staticClass:"ivu-ml-8",attrs:{size:"default",type:"danger",icon:"md-close"},on:{click:function(e){return t.deleteFileFunc(!1)}}},[t._v("批量删除")])],1),a("Col",{staticClass:"ivu-text-right",attrs:{span:"8"}},[a("Upload",{ref:"upload",attrs:{multiple:"",headers:t.upload.headers,"show-upload-list":!1,data:t.upload.params,"max-size":1e5,"on-success":t.handleUploadSuccess,"on-error":t.handleUploadError,action:t.uploadAction,"before-upload":t.onBeforeUploadImage}},[a("Button",{attrs:{size:"default",icon:"md-cloud-upload",type:"primary",loading:t.upload.loading}},[t._v("点击上传")])],1)],1)],1),a("div",{staticClass:"fileContainer"},[a("div",{staticClass:"file-type"},[a("ul",t._l(t.typeList,function(e,i){return a("li",{key:i,class:t.selectedGroupId==e.group_id?"item active":"item",on:{click:function(a){return t.selectTypeFunc(e.group_id)}}},[t._v("\n            "+t._s(e.group_name)+"\n            "),null!=e.group_id?a("div",{staticClass:"operation",on:{click:function(t){t.stopPropagation()}}},[a("p",{on:{click:function(a){return t.editCategoryFunc(e)}}},[a("Icon",{attrs:{type:"md-card"}})],1),a("p",{on:{click:function(a){return t.deleteCategoryFunc(e.group_id)}}},[a("Icon",{attrs:{type:"md-trash"}})],1)]):t._e()])}),0)]),a("div",{staticClass:"file-content"},[a("ul",{staticClass:"fileContainerUI clearfix"},t._l(t.fileList.list,function(e,i){return a("li",{key:i,staticClass:"file",on:{click:function(a){return t.selectFileFunc(e,i)}}},[1==e.selected?a("div",{staticClass:"selectedIcon"},[a("Icon",{attrs:{type:"md-checkmark"}})],1):t._e(),a("img",{style:"background-image:url("+e.file_path+")",attrs:{scr:e.file_path,alt:""}}),a("p",{staticClass:"desc"},[t._v(t._s(e.real_name))]),a("div",{staticClass:"bottom-shade",on:{click:function(t){t.stopPropagation()}}},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){return t.deleteFileFunc(e)}}},[a("Icon",{staticStyle:{"font-size":"18px"},attrs:{type:"ios-trash-outline"}})],1)])])}),0)])]),a("div",{staticClass:"pagination-wrap"},[a("el-pagination",{attrs:{"current-page":t.curPage,"page-sizes":[12,24,36,42,48],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalDataNumber},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{size:"default"},on:{click:t.cancelFunc}},[t._v("取 消")]),a("Button",{attrs:{size:"default",type:"primary"},on:{click:t.confirmFunc}},[t._v("确 定")])],1)],1),a("AddCategory",{attrs:{showSecondModal:t.isShowCategory,isEditMode:t.isEditMode,category:t.category},on:{"update:showSecondModal":function(e){t.isShowCategory=e},"update:show-second-modal":function(e){t.isShowCategory=e},closeCategory:t.closeCategoryFunc}})],1)},o=[],n=a("a34a"),s=a.n(n),r=a("c276"),c=a("d708"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"添加分类",width:"30%"},on:{"on-cancel":t.handleClose,"on-visible-change":t.onVisableChange,"on-ok":function(e){return t.submitForm("form")}},model:{value:t.showSecondModal,callback:function(e){t.showSecondModal=e},expression:"showSecondModal"}},[a("Form",{ref:"form",staticClass:"demo-ruleForm",attrs:{size:"small",model:t.formData,"label-width":"100px"}},[a("FormItem",{attrs:{label:"分类名称",prop:"group_name",rules:[{required:!0,message:"名字不能为空",trigger:"blur"}]}},[a("Input",{model:{value:t.formData.group_name,callback:function(e){t.$set(t.formData,"group_name",t._n(e))},expression:"formData.group_name"}})],1)],1)],1)},u=[];function d(t,e,a,i,o,n,s){try{var r=t[n](s),c=r.value}catch(l){return void a(l)}r.done?e(c):Promise.resolve(c).then(i,o)}function h(t){return function(){var e=this,a=arguments;return new Promise(function(i,o){var n=t.apply(e,a);function s(t){d(n,i,o,s,r,"next",t)}function r(t){d(n,i,o,s,r,"throw",t)}s(void 0)})}}var p={data:function(){return{formData:{group_name:""}}},props:{isEditMode:!1,category:{},showSecondModal:{type:Boolean,default:!1}},created:function(){null!=this.category&&(this.formData.group_name=this.category.group_name,this.formData.group_id=this.category.group_id)},watch:{isEditMode:function(){},category:function(){null==this.category?(this.formData.group_name="",this.formData.group_id=""):(this.formData.group_name=this.category.group_name,this.formData.group_id=this.category.group_id)}},methods:{cancelFunc:function(){this.showSecondModal=!1},addCategory:function(){var t=this,e={group_name:this.formData.group_name};this.$http.query("/Manage/File/addCategory",e).then(function(){var e=h(s.a.mark(function e(a){return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.$Message.success("添加成功"),t.handleClose({status:"success"});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(t){console.log(t)})},editCategory:function(){var t=this,e=this,a=this.formData;this.$http.query("/Manage/File/updateCategory",a).then(function(){var a=h(s.a.mark(function a(i){return s.a.wrap(function(a){while(1)switch(a.prev=a.next){case 0:t.$Message.success("编辑成功"),e.handleClose({status:"success"});case 2:case"end":return a.stop()}},a)}));return function(t){return a.apply(this,arguments)}}()).catch(function(t){console.log(t)})},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;console.log("editMode"),console.log(e.isEditMode),e.category&&e.isEditMode?e.editCategory():e.isEditMode?e.$Message.success("未指定操作"):e.addCategory()})},handleClose:function(t){this.$emit("closeCategory",t)},onVisableChange:function(t){t&&(this.isEditMode||(this.formData.group_name="")),this.$emit("update:showSecondModal",t)}}},g=p,f=a("2877"),m=Object(f["a"])(g,l,u,!1,null,null,null),y=m.exports;function v(t,e,a,i,o,n,s){try{var r=t[n](s),c=r.value}catch(l){return void a(l)}r.done?e(c):Promise.resolve(c).then(i,o)}function _(t){return function(){var e=this,a=arguments;return new Promise(function(i,o){var n=t.apply(e,a);function s(t){v(n,i,o,s,r,"next",t)}function r(t){v(n,i,o,s,r,"throw",t)}s(void 0)})}}var C={components:{AddCategory:y},data:function(){return{isEditMode:!1,showAddCategory:!1,dialogWidth:"910px",selectedGroupId:null,typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1},upload:{headers:{"x-auth-token":r["a"].cookies.get("token")},action:c["a"].apiBaseURL+"Publics/Upload/image",loading:!1,show:!1,process:!0,file:"",params:{},data:{}},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1,category:{group_id:null,group_name:""},fileIds:[]}},props:["config"],created:function(){if("[object object]"===Object.prototype.toString.call(this.config).toLowerCase())for(var t in this.config)this.this_config[t]=this.config[t];this.getFileCategory(),this.getData()},mounted:function(){this.uploadAction=c["a"].apiBaseURL+"Publics/Upload/image"},methods:{getFileCategory:function(){var t=this,e={};this.$http.query("/Manage/File/category",e).then(function(){var e=_(s.a.mark(function e(a){var i;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:i=[{group_id:null,group_name:"全部"},{group_id:0,group_name:"未分组"}],t.typeList=i.concat(a.list),console.log(t.typeList);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(){t.loading=!1})},addCategory:function(){this.isEditMode=!1,this.isShowCategory=!1,this.isShowCategory=!0},editCategoryFunc:function(t){this.isEditMode=!0,this.isShowCategory=!0,this.category=t},closeCategoryFunc:function(t){null!=t&&this.getFileCategory(),this.isShowCategory=!1},deleteCategoryFunc:function(t){var e=this;this.$Modal.confirm({title:"删除提示",content:"将永久删除该记录, 是否继续？",onOk:function(){e.deleteCategory(t)}})},deleteCategory:function(t){var e=this,a={group_id:t};this.$http.query("/Manage/File/deleteCategory",a).then(function(){var t=_(s.a.mark(function t(a){return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.$Message.success("删除成功"),e.getFileCategory();case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.loading=!1,e.$Message.success("删除失败")})},selectTypeFunc:function(t){this.selectedGroupId=t,this.curPage=1,this.getData()},handleCurrentChange:function(t){this.curPage=t,this.getData()},handleSizeChange:function(t){this.curPage=1,this.pageSize=t,this.getData()},getData:function(){var t=this,e={page:this.curPage,page_size:this.pageSize,group_id:this.selectedGroupId};this.$http.query("/Manage/File/fileList",e).then(function(){var e=_(s.a.mark(function e(a){return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.loading=!1,t.fileList=a,t.totalDataNumber=a.total;case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(){t.loading=!1})},moveTypeFunc:function(t){var e=this,a=[];this.fileList.list.forEach(function(t){t.selected&&a.push(t.file_id)}),0!==a.length?this.$Modal.confirm({title:"移动提示",content:"确定移动选中的文件吗？, 是否继续？",onOk:function(){e.moveType(t,a)}}):this.$Message.warning("请选择文件")},moveType:function(t,e){var a=this,i={group_id:t,file_ids:e.join(",")};this.$http.query("/Manage/File/moveFiles",i).then(function(){var t=_(s.a.mark(function t(e){return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:a.$Message.success("操作成功"),a.getFileCategory(),a.getData();case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){a.loading=!1})},fileChange:function(t){console.log(t)},onBeforeUploadImage:function(t){this.upload.loading=!0;var e="image/jpeg"===t.type||"image/jpg",a=t.size/1024/1024<100;return e?a?(this.upload.file=t,this.uploadImage(),!1):(this.upload.loading=!1,this.$Message.error("上传文件大小不能超过 100MB!"),!1):(this.upload.loading=!1,this.$Message.error("上传文件只能是图片格式!"),!1)},handleUploadSuccess:function(t,e){this.upload.loading=!1,this.getData()},uploadImage:function(){this.upload.params.group_id=this.selectedGroupId,this.$refs.upload.post(this.upload.file),this.upload.loading=!1},selectFileFunc:function(t,e){t.selected?(t.selected=!1,this.record--):(t.selected=!0,this.record++),this.$set(this.fileList.list,e,t)},handleUploadError:function(t,e){this.$Message.error(e.message)},deleteFileFunc:function(t){var e=this;this.$Modal.confirm({title:"删除提示",content:"此操作将永久删除该文件, 是否继续？",onOk:function(){e.deleteFile(t)}})},deleteFile:function(t){var e=this,a=[];if(t)a.push(t.file_id);else for(var i=0;i<this.fileList.list.length;i++){var o=this.fileList.list[i];o.selected&&a.push(o.file_id)}var n={file_ids:a.join(",")};this.$http.query("/Manage/File/deleteFiles",n).then(function(){var t=_(s.a.mark(function t(a){return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.loading=!1,e.getData();case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.loading=!1})},confirmFunc:function(){for(var t=[],e=0,a=0;a<this.fileList.list.length;a++){var i=this.fileList.list[a];if(i.selected){var o={file_id:i.file_id,file_path:i.file_path};t.push(o),e++}if(e>this.this_config.total)break}this.$emit("returnImgs",t)},cancelFunc:function(){this.$emit("returnImgs",null)}}},w=C,F=(a("45fe"),Object(f["a"])(w,i,o,!1,null,"9740c0fa",null));e["a"]=F.exports},"79da":function(t,e,a){}}]);
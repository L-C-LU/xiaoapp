(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-63b5b504"],{2748:function(e,t,n){},"3bca":function(e,t,n){"use strict";n.r(t);var l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Button",{attrs:{type:"primary",ghost:"",icon:"md-add"},on:{click:e.handleOpenCreate}},[e._v("添加角色")]),n("Button",{directives:[{name:"show",rawName:"v-show",value:e.selectedData.length,expression:"selectedData.length"}],staticClass:"ivu-ml-8",attrs:{type:"error",ghost:"",icon:"md-trash"},on:{click:e.handleDeleteMultiple}},[e._v("批量删除")]),n("div",{staticClass:"ivu-inline-block ivu-fr"},[n("Dropdown",{attrs:{trigger:"click"},on:{"on-click":e.handleChangeTableSize}},[n("Tooltip",{staticClass:"ivu-ml",attrs:{content:"密度",placement:"top"}},[n("i-link",[n("Icon",{attrs:{type:"md-list"}})],1)],1),n("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[n("DropdownItem",{attrs:{name:"default",selected:"default"===e.tableSize}},[e._v("默认")]),n("DropdownItem",{attrs:{name:"large",selected:"large"===e.tableSize}},[e._v("宽松")]),n("DropdownItem",{attrs:{name:"small",selected:"small"===e.tableSize}},[e._v("紧凑")])],1)],1),n("Tooltip",{staticClass:"ivu-ml",attrs:{content:e.tableFullscreen?"退出全屏":"全屏",placement:"top"}},[n("i-link",{nativeOn:{click:function(t){return e.handleFullscreen(t)}}},[n("Icon",{attrs:{custom:e.tableFullscreen?"i-icon i-icon-exit-full-screen":"i-icon i-icon-full-screen"}})],1)],1),n("Tooltip",{staticClass:"ivu-ml",attrs:{content:"刷新",placement:"top"}},[n("i-link",{nativeOn:{click:function(t){return e.handleRefresh(t)}}},[n("Icon",{attrs:{custom:"i-icon i-icon-refresh"}})],1)],1),n("Dropdown",{attrs:{trigger:"click"}},[n("Tooltip",{staticClass:"ivu-ml",attrs:{content:"列设置",placement:"top"}},[n("i-link",[n("Icon",{attrs:{type:"md-options"}})],1)],1),n("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[n("div",{staticClass:"ivu-p-8"},[e._v("列展示")]),n("Divider",{staticClass:"ivu-mt-8 ivu-mb-8",attrs:{size:"small"}}),e._l(e.columns,function(t){return t.title?n("li",{key:t.title,staticClass:"ivu-dropdown-item",on:{click:function(e){t.show=!t.show}}},[n("Checkbox",{model:{value:t.show,callback:function(n){e.$set(t,"show",n)},expression:"item.show"}}),n("span",[e._v(e._s(t.title))])],1):e._e()})],2)],1)],1),n("Table",{ref:"table",staticClass:"ivu-mt",attrs:{columns:e.tableColumns,data:e.data.list,loading:e.loading,size:e.tableSize},on:{"on-sort-change":e.handleSortChange,"on-select":e.handleSelect,"on-select-cancel":e.handleSelectCancel,"on-select-all":e.handleSelectAll,"on-select-all-cancel":e.handleClearSelect},scopedSlots:e._u([{key:"is_default",fn:function(t){var l=t.row;return[1===l.is_default?n("Tag",{attrs:{color:"green"}},[e._v("是")]):e._e(),0===l.is_default?n("Tag",{attrs:{color:"red"}},[e._v("否")]):e._e()]}},{key:"create_time",fn:function(t){var n=t.row;return[e._v("\n            "+e._s(e.$helper.getTimeStr(n.create_time))+"\n        ")]}},{key:"update_time",fn:function(t){var n=t.row;return[e._v("\n            "+e._s(e.$helper.getTimeStr(n.update_time))+"\n        ")]}},{key:"action",fn:function(t){var l=t.row;return[n("div",{on:{click:function(e){e.stopPropagation(),e.preventDefault()}}},[n("a",{attrs:{type:"text"},on:{click:function(t){return e.handleOpenMenu(l.role_id)}}},[e._v("菜单权限")]),n("Divider",{attrs:{type:"vertical"}}),n("a",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(l.role_id)}}},[e._v("编辑")]),n("Divider",{attrs:{type:"vertical"}}),n("a",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(l.role_id)}}},[e._v("删除")])],1)]}}])}),n("div",{staticClass:"ivu-mt ivu-text-center"},[n("Page",{attrs:{total:e.data.total,current:e.data.page,"show-total":"","show-sizer":"","show-elevator":"","page-size":e.data.page_size},on:{"update:current":function(t){return e.$set(e.data,"page",t)},"on-change":e.handleChangePage,"on-page-size-change":e.handleChangePageSize}})],1),n("Drawer",{attrs:{styles:e.drawer.styles,title:"edit"===e.drawer.type?"编辑角色":"添加角色","before-close":e.handleCloseEdit,transfer:!1,width:"360"},model:{value:e.drawer.show,callback:function(t){e.$set(e.drawer,"show",t)},expression:"drawer.show"}},[e.roleInfo&&e.roleInfoReady?n("Form",{ref:"roleInfoForm",attrs:{model:e.roleInfo,rules:e.roleInfoRules,"label-position":"top","label-colon":"","hide-required-mark":""}},[n("FormItem",{attrs:{prop:"name",label:"管理等级"}},[n("Select",{attrs:{placeholder:"请选择管理等级",clearable:""},model:{value:e.roleInfo.level,callback:function(t){e.$set(e.roleInfo,"level",e._n(t))},expression:"roleInfo.level"}},[n("Option",{attrs:{value:100}},[e._v("系统管理员")]),n("Option",{attrs:{value:80}},[e._v("子管理员")]),n("Option",{attrs:{value:0}},[e._v("注册用户")])],1)],1),n("FormItem",{attrs:{prop:"name",label:"角色名称"}},[n("Input",{attrs:{placeholder:"请输入角色名称，必填"},model:{value:e.roleInfo.name,callback:function(t){e.$set(e.roleInfo,"name",t)},expression:"roleInfo.name"}})],1),n("FormItem",{attrs:{prop:"remark",label:"说明"}},[n("Input",{attrs:{placeholder:"请输入说明"},model:{value:e.roleInfo.remark,callback:function(t){e.$set(e.roleInfo,"remark",t)},expression:"roleInfo.remark"}})],1),n("FormItem",{attrs:{prop:"is_default"}},[n("div",{attrs:{slot:"label"},slot:"label"},[e._v("\n                    是否默认角色\n                    "),n("Tooltip",{attrs:{content:"开启后，新注册用户默认拥有该角色"}},[n("Icon",{attrs:{type:"md-help-circle"}})],1)],1),n("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.roleInfo.is_default,callback:function(t){e.$set(e.roleInfo,"is_default",t)},expression:"roleInfo.is_default"}},[n("Icon",{attrs:{slot:"open",type:"md-checkmark"},slot:"open"}),n("Icon",{attrs:{slot:"close",type:"md-close"},slot:"close"})],1)],1)],1):e._e(),"edit"===e.drawer.type?n("div",{staticClass:"page-sys-role-drawer-footer"},[n("Button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.handleSubmitEdit}},[e._v("提交")])],1):e._e(),"new"===e.drawer.type?n("div",{staticClass:"page-sys-role-drawer-footer"},[n("Button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.handleSubmitNew}},[e._v("提交")])],1):e._e()],1),n("Modal",{attrs:{title:e.roleInfo?"分配 "+e.roleInfo.name+" 的菜单权限":"",transfer:!1,styles:{top:"24px"}},model:{value:e.modal.show,callback:function(t){e.$set(e.modal,"show",t)},expression:"modal.show"}},[n("div",{style:e.modalStyle},[n("Tree",{attrs:{data:e.roleMenuList,"show-checkbox":"","check-strictly":"","check-directly":""}})],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{directives:[{name:"show",rawName:"v-show",value:!e.toggleExpand,expression:"!toggleExpand"}],attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleToggleExpandAll(!0)}}},[e._v("全部展开")]),n("Button",{directives:[{name:"show",rawName:"v-show",value:e.toggleExpand,expression:"toggleExpand"}],attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleToggleExpandAll(!1)}}},[e._v("全部收起")]),n("Button",{directives:[{name:"show",rawName:"v-show",value:!e.toggleSelectAll,expression:"!toggleSelectAll"}],attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleToggleSelectAll(!0)}}},[e._v("全部选择")]),n("Button",{directives:[{name:"show",rawName:"v-show",value:e.toggleSelectAll,expression:"toggleSelectAll"}],attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleToggleSelectAll(!1)}}},[e._v("全部取消")]),n("Divider",{attrs:{type:"vertical"}}),n("Button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.handleSubmitMenu}},[e._v("提交")])],1)])],1)},a=[],i=n("a34a"),o=n.n(i),r=n("2ef0");function s(e,t,n,l,a,i,o){try{var r=e[i](o),s=r.value}catch(c){return void n(c)}r.done?t(s):Promise.resolve(s).then(l,a)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(l,a){var i=e.apply(t,n);function o(e){s(i,l,a,o,r,"next",e)}function r(e){s(i,l,a,o,r,"throw",e)}o(void 0)})}}function u(e){return f(e)||h(e)||d()}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function f(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}var p={data:function(){return{columns:[{type:"selection",minWidth:60,align:"center",show:!0},{title:"ID",key:"role_id",sortable:"custom",minWidth:140,show:!1},{title:"角色名称",key:"name",sortable:"custom",minWidth:140,show:!0},{title:"说明",key:"remark",minWidth:140,show:!0},{title:"创建时间",key:"create_time",slot:"create_time",sortable:"custom",minWidth:200,show:!0},{title:"更新时间",key:"update_time",slot:"update_time",sortable:"custom",minWidth:200,show:!0},{title:"是否默认角色",key:"is_default",slot:"is_default",align:"center",minWidth:200,show:!0},{title:"操作",key:"action",slot:"action",minWidth:200,align:"center",fixed:"right",show:!0}],loading:!1,list:[],data:{list:[],page:1,page_size:10,page_count:0,total:0},selectedData:[],sort_direction:"normal",sort_column:"",tableSize:"default",tableFullscreen:!1,drawer:{show:!1,type:"edit",styles:{height:"calc(100% - 55px)",overflow:"auto",paddingBottom:"53px",position:"static"}},roleInfo:null,roleInfoRules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},roleInfoString:"",roleInfoReady:!0,submitting:!1,modal:{show:!1},menuList:[],roleMenuList:[],toggleExpand:!0,toggleSelectAll:!1}},computed:{tableColumns:function(){var e=u(this.columns);return e.filter(function(e){return e.show})},modalStyle:function(){return{height:document.body.clientHeight-186+"px",overflow:"auto"}}},methods:{getData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.loading){this.loading=!0;var n={page_size:this.data.page_size,page:this.data.page,sort_column:this.sort_column,sort_direction:this.sort_direction,dict:""};this.$http.query("/Manage/Role/list",n).then(function(){var n=c(o.a.mark(function n(l){return o.a.wrap(function(n){while(1)switch(n.prev=n.next){case 0:console.log(l),t&&(e.dict=l.dict),e.data.list=l.list,e.data.total=l.total,e.data.page=l.page,e.data.page_size=l.page_size,e.data.page_count=l.page_count,e.loading=!1;case 8:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()).catch(function(e){console.log(e)})}},handleChangeTableSize:function(e){this.tableSize=e},handleFullscreen:function(){this.tableFullscreen=!this.tableFullscreen,this.$emit("on-fullscreen",this.tableFullscreen)},handleRefresh:function(){this.getData()},handleChangePage:function(e){this.data.page=e,this.getData()},handleChangePageSize:function(e){this.data.page=1,this.data.page_size=e,this.getData()},handleSortChange:function(e){var t=e.key,n=e.order;this.data.page=1,this.sort_direction=n,this.sort_column=t,this.getData()},handleSelect:function(e,t){this.selectedData.push(t)},handleSelectCancel:function(e,t){var n=this.selectedData.findIndex(function(e){return e.role_id===t.role_id});this.selectedData.splice(n,1)},handleSelectAll:function(e){var t=this;e.forEach(function(e){t.selectedData.findIndex(function(t){return t.role_id===e.role_id})<0&&t.selectedData.push(e)})},handleClearSelect:function(){this.selectedData=[]},handleGetRole:function(e){return this.data.list.find(function(t){return t.role_id===e})},handleDelete:function(e){var t=this;this.loading||(console.log("roleId="+e),this.$Modal.confirm({title:"删除确认",content:"您确认要删除角色 <strong>".concat(this.handleGetRole(e).name,"</strong>？"),loading:!0,onOk:function(){var n={role_id:e};t.$http.query("/Manage/Role/delete",n).then(function(){var e=c(o.a.mark(function e(n){return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.$Modal.remove(),t.handleClearSelect(),t.handleChangePage(1);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log(e)})}}))},handleDeleteMultiple:function(){var e=this;if(!this.loading){var t=this.selectedData.map(function(e){return e.role_id}),n=this.selectedData.map(function(e){return e.name});this.$Modal.confirm({title:"删除确认",content:"您确认要删除角色 <strong>".concat(n,"</strong>？"),loading:!0,onOk:function(){var n={role_ids:t};e.$http.query("/Manage/Role/deleteMultiple",n).then(function(){var t=c(o.a.mark(function t(n){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.$Modal.remove(),e.handleClearSelect(),e.handleChangePage(1);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.$Modal.remove()})}})}},handleEdit:function(e){this.roleInfo=Object(r["cloneDeep"])(this.handleGetRole(e)),this.roleInfoString=JSON.stringify(this.roleInfo),this.drawer.type="edit",this.drawer.show=!0,this.handleInitRoleInfoForm()},handleInitRoleInfoForm:function(){var e=this;this.roleInfoReady=!1,this.$nextTick(function(){e.roleInfoReady=!0})},handleCloseEdit:function(){var e=this;if("edit"===this.drawer.type){var t=Object(r["cloneDeep"])(this.roleInfo),n=JSON.stringify(t);if(n!==this.roleInfoString)return new Promise(function(t){e.$Modal.confirm({title:"关闭确认",content:"您已经修改了角色信息，是否直接关闭？",onOk:function(){t()}})})}},handleOpenCreate:function(){this.roleInfo={id:"",name:"",remark:"",create_time:"",update_time:"",is_default:0,menu_list:[]},this.drawer.type="new",this.drawer.show=!0,this.handleInitRoleInfoForm()},handleSubmitEdit:function(){var e=this;this.submitting||this.$refs.roleInfoForm.validate(function(t){if(t){e.submitting=!0;var n=e.roleInfo;e.$http.query("/Manage/Role/update",n).then(function(){var t=c(o.a.mark(function t(n){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.submitting=!1,e.drawer.show=!1,e.handleClearSelect(),e.handleChangePage(1);case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.submitting=!1})}})},handleSubmitNew:function(){var e=this;this.submitting||this.$refs.roleInfoForm.validate(function(t){if(t){var n=e.roleInfo;e.$http.query("/Manage/Role/add",n).then(function(){var t=c(o.a.mark(function t(n){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.$Message.success("角色添加成功"),e.submitting=!1,e.drawer.show=!1,e.handleClearSelect(),e.handleChangePage(1),e.$refs.roleInfoForm.resetFields();case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.submitting=!1})}e.submitting=!1})},handleOpenMenu:function(e){this.roleInfo=Object(r["cloneDeep"])(this.handleGetRole(e)),this.roleInfoString=JSON.stringify(this.roleInfo),this.roleMenuList=Object(r["cloneDeep"])(this.menuList),this.handleToggleExpandAll(!0,!0),this.toggleSelectAll=0===this.handleCheckSelectAllStatus(this.roleMenuList,[]).length,this.modal.show=!0},handleCheckSelectAllStatus:function(e,t){var n=this;return e.forEach(function(e){var l={};for(var a in e)"children"!==a&&(l[a]=Object(r["cloneDeep"])(e[a]));l.checked||t.push(l),e.children&&e.children.length&&(l.children=[]),e.children&&n.handleCheckSelectAllStatus(e.children,l.children)}),t},handleToggleExpandAll:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.toggleExpand=e,this.roleMenuList=this.handleToggleExpandNode(this.roleMenuList,e,t,[])},handleToggleExpandNode:function(e,t,n,l){var a=this;return e.forEach(function(e){var i={};for(var o in e)"children"!==o&&(i[o]=Object(r["cloneDeep"])(e[o]));if(i.expand=t,n){var s=u(a.roleInfo.menu_list);i.checked=!!s.find(function(e){return e===i.id.toString()})}e.children&&e.children.length&&(i.children=[]),l.push(i),e.children&&a.handleToggleExpandNode(e.children,t,n,i.children)}),console.log(l),l},handleToggleSelectAll:function(e){this.toggleSelectAll=e,this.roleMenuList=this.handleToggleSelectAllNode(this.roleMenuList,e,[])},handleToggleSelectAllNode:function(e,t,n){var l=this;return e.forEach(function(e){var a={};for(var i in e)"children"!==i&&(a[i]=Object(r["cloneDeep"])(e[i]));a.checked=t,e.children&&e.children.length&&(a.children=[]),n.push(a),e.children&&l.handleToggleSelectAllNode(e.children,t,a.children)}),n},handleGetMenuList:function(){var e=this,t={};this.$http.query("/Manage/Menu/getAll",t).then(function(){var t=c(o.a.mark(function t(n){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.menuList=n.list;case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(e){console.log(e)})},handleSubmitMenu:function(){var e=this;if(!this.submitting){this.submitting=!0;var t={role_id:this.roleInfo.role_id,menu_list:this.handleGetMenuIds(this.roleMenuList,[])};this.$http.query("/Manage/Role/updateMenu",t).then(function(){var t=c(o.a.mark(function t(n){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.submitting=!1,e.modal.show=!1,e.handleClearSelect(),e.handleChangePage(1);case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){e.submitting=!1})}},handleGetMenuIds:function(e,t){var n=this;return e.forEach(function(e){var l={};for(var a in e)"children"!==a&&(l[a]=Object(r["cloneDeep"])(e[a]));l.checked&&t.push(l.id),e.children&&e.children.length&&(l.children=[]),e.children&&n.handleGetMenuIds(e.children,t)}),t}},mounted:function(){this.handleGetMenuList()}},g=p,m=(n("efdd"),n("2877")),v=Object(m["a"])(g,l,a,!1,null,null,null);t["default"]=v.exports},efdd:function(e,t,n){"use strict";var l=n("2748"),a=n.n(l);a.a}}]);